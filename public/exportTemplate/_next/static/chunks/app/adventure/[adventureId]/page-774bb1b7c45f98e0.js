(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[488],{8918:function(t,l,i){"use strict";i.r(l),i.d(l,{default:function(){return X}});var n=i(9268),o=i(6006),r=i(8362);let d=(t,l,i,n)=>{let o=[],r=Math.floor(t/i),d=Math.floor(l/i),a=t%i,s=l%i,u=Math.min(r,d),p=Math.max(r,d),f=Math.min(a,s),w=Math.max(a,s);for(let t=u;t<=p;t++)for(let l=f;l<=w;l++)o.push(l+t*i);return o},a=t=>({line:Math.floor(t/10)+1,column:t%10+1}),s=t=>{let{line:l,column:i}=t;return(l-1)*10+(i-1)},u=t=>{let{line:l,column:i}=a(t);return 1===l?null:s({line:l-1,column:i})},p=t=>{let{line:l,column:i}=a(t);return 10===l?null:s({line:l+1,column:i})},f=t=>{let{line:l,column:i}=a(t);return 1===i?null:s({line:l,column:i-1})},w=t=>{let{line:l,column:i}=a(t);return 10===i?null:s({line:l,column:i+1})},x=(t,l)=>{let i=l[t],n=[],o=[],r=t=>{if(o.includes(t))return;o.push(t);let d=l[t];if(d!==i)return;n.push(t);let a=u(t);null!==a&&r(a);let s=p(t);null!==s&&r(s);let x=w(t);null!==x&&r(x);let b=f(t);null!==b&&r(b)};return r(t),n},b={},h={get(t,l){let i=window._s.getState().variables,n=i[l];return void 0===n?0:n},set(t,l,i){var n;let{variables:o,subscribers:r}=window._s.getState(),d={...o,[l]:i};window._s.setState({variables:d});let a=null!==(n=null==r?void 0:r[l])&&void 0!==n?n:[];return console.log("subscribersForVariable | proxy.ts l28",a),a.forEach(t=>t(i)),!0}},m=new Proxy(b,h),I={},C={get(t,l){var i;let n=window._s.getState().subs;return null!==(i=null==n?void 0:n[l])&&void 0!==i?i:[]},set(t,l,i){var n;let o=window._s.getState().subscribers;console.log("unparsedCallback | proxy.ts l64",i);let r=null!==(n=null==o?void 0:o[l])&&void 0!==n?n:[];r.push(i),console.log("subscribersForVariable | proxy.ts l71",r);let d={...o,[l]:r};return window._s.setState({subscribers:d}),!0}},S=new Proxy(I,C),j={},y={get(t,l){var i;let n=window._s.getState().configs;return null!==(i=null==n?void 0:n[l])&&void 0!==i?i:{}},set(t,l,i){let n=window._s.getState().configs,o={...n,[l]:{...n[l],...i}};return window._s.setState({configs:o}),!0}},_=new Proxy(j,y),k={},G={get(t,l){var i,n,o,r;let d=l.split("_")[0],a=parseInt(null!==(o=null===(i=l.match(/gridId(\d*)/))||void 0===i?void 0:i[1])&&void 0!==o?o:""),s=parseInt(null!==(r=null===(n=l.match(/cellIndex(\d*)/))||void 0===n?void 0:n[1])&&void 0!==r?r:""),u=window._s.getState().getCell({gridId:a,cellIndex:s});return u[d]},set(t,l,i){var n,o,r,d;let a=l.split("_")[0],s=parseInt(null!==(r=null===(n=l.match(/gridId(\d*)/))||void 0===n?void 0:n[1])&&void 0!==r?r:""),u=parseInt(null!==(d=null===(o=l.match(/cellIndex(\d*)/))||void 0===o?void 0:o[1])&&void 0!==d?d:"");return window._s.getState().updateCell({gridId:s,cellIndex:u,cellUpdate:{[a]:i}}),!0}},P=new Proxy(k,G),E=()=>({color:"",emoji:"",onClickCScript:"",onViewCScript:"",onInitCScript:""}),N=()=>({text:"",cells:Array(100).fill({}).map(E),onViewGScript:"",onInitGScript:""}),V=()=>({activeGridId:0,selectedTool:"",isToolCursorVisible:!1,selectedColor:null,selectedEmoji:null,mouseDownCellIndex:null,lastEmojis:[],copiedCell:E(),grids:[{id:0,...N()}],firstGridId:0,onInitAScript:"",adventure:null,isChanged:!1,activeCScriptTab:"onClickCScript",isInitFinished:!1,text1:"",text2:"",text3:"",variables:{},subscribers:{},configs:{}}),$=[],D=t=>{$.push(JSON.parse(JSON.stringify({activeGridId:t.activeGridId,grids:t.grids}))),$.length>20&&$.shift()},M=()=>$=[],z=(0,r.Z)((t,l)=>({set:i=>{t(i),t({isChanged:!0}),l()},reset:()=>t(V()),...V(),undo:()=>{if($.length>1){$.pop();let t=$[$.length-1];l().set(t)}},getCell(t){var i,n;let{gridId:o,cellIndex:r}=t,{grids:d}=l(),a=d.find(t=>t.id===o);return void 0===a?null:null!==(n=null===(i=a.cells)||void 0===i?void 0:i[r])&&void 0!==n?n:null},updateCell(t){let{gridId:i,cellIndex:n,cellUpdate:o}=t,{grids:r}=l(),d=r.find(t=>t.id===i);return void 0===d?console.error("grid ".concat(i," not found in the store")):n>=100?console.error("cellIndex ".concat(n," does not exist (must be 0-100)")):void(d.cells[n]={...d.cells[n],...o},l().set({grids:[...r]}),D(l()))},updateCellWithAppend(t){let{gridId:i,cellIndex:n,cellUpdate:o}=t,{grids:r}=l(),d=r.find(t=>t.id===i);if(void 0===d)return console.error("grid ".concat(i," not found in the store"));if(n>=100)return console.error("cellIndex ".concat(n," does not exist (must be 0-100)"));let a={...d.cells[n]};void 0!==o.emoji&&(a.emoji+=o.emoji),void 0!==o.onClickCScript&&(a.onClickCScript+=(""===a.onClickCScript?"":"\n")+o.onClickCScript),void 0!==o.onViewCScript&&(a.onViewCScript+=(""===a.onViewCScript?"":"\n")+o.onViewCScript),void 0!==o.onInitCScript&&(a.onInitCScript+=(""===a.onInitCScript?"":"\n")+o.onInitCScript),d.cells[n]={...d.cells[n],...a},l().set({grids:[...r]}),D(l())},updateSquare:t=>{let{gridId:i,cellIndex1:n,cellIndex2:o,cellUpdate:r}=t,{grids:a}=l(),s=a.find(t=>t.id===i);if(void 0===s)return console.error("grid ".concat(i," not found in the store"));if(n>=100||n<0)return console.error("cellIndex ".concat(n," does not exist (must be 0-100)"));if(o>=100||o<0)return console.error("cellIndex ".concat(o," does not exist (must be 0-100)"));let u=10,p=10,f=d(n,o,u,p);f.forEach(t=>{s.cells[t]={...s.cells[t],...r}}),l().set({grids:[...a]}),D(l())},floodFill:t=>{let{gridId:i,cellIndex:n,cellUpdate:o}=t,{grids:r}=l(),d=r.find(t=>t.id===i);if(void 0===d)return console.error("grid ".concat(i," not found in the store"));if(n>=100||n<0)return console.error("cellIndex ".concat(n," does not exist (must be 0-100)"));let a=[],s=(null==o?void 0:o.color)!==void 0;s&&(a=x(n,d.cells.map(t=>t.color)));let u=(null==o?void 0:o.emoji)!==void 0;u&&(a=x(n,d.cells.map(t=>t.emoji))),a.forEach(t=>{d.cells[t]={...d.cells[t],...o}}),l().set({grids:[...r]}),D(l())},pickEmoji:i=>{let n=l().selectedTool;"pencil"!==n&&"square"!==n&&t({selectedTool:"pencil"}),t({selectedEmoji:i,selectedColor:null});let o=l().lastEmojis;if(!o.includes(i)){let l=[i,...o];l.length>20&&(l.length=20),t({lastEmojis:l})}},updateGrid:t=>{let{gridId:i,gridUpdate:n}=t,{grids:o}=l(),r=o.findIndex(t=>t.id===i);if(-1===r)return console.error("grid ".concat(i," not found in the store"));o[r]={...o[r],...n},l().set({grids:[...o]}),D(l())},createGrid:t=>{let{name:i,idOfGridToCopy:n}=t,{grids:o}=l(),r=Math.max(...o.map(t=>t.id))+1,d={};if(void 0!==n){let t=o.find(t=>t.id===n);if(void 0===t)return;d={...t,cells:t.cells.map(t=>({...t,onClickCScript:"",onViewCScript:"",onInitCScript:""}))}}let a={...N(),...void 0!==n?d:{},...void 0!==i?{text:i}:{},id:r},s=[...o,a];return l().set({grids:s}),D(l()),a},deleteGrid:t=>{let{grids:i,activeGridId:n,firstGridId:o}=l();if(i.length<=1)return;let r=t===n,d=t===o,a=i.filter(l=>l.id!==t);l().set({activeGridId:r?a[a.length-1].id:n}),l().set({firstGridId:d?a[a.length-1].id:o}),l().set({grids:a}),D(l())}}));var U=z;window._h=$,window._s=z,window._ss=()=>z.getState(),window._g={},window._variableProxy=m,window._subscriberProxy=S,window._configProxy=_,window._updateProxy=P;var F=i(207),A=i(2698),O=i.n(A);let T=t=>{let{}=t,l=U(t=>t.text1),i=U(t=>t.text2),r=U(t=>t.text3),d=U(t=>t.variables),a=U(t=>t.configs),s=U(t=>t.activeGridId),u=(0,o.useMemo)(()=>{let t=[];for(let[l,i]of Object.entries(a))(null==i?void 0:i.isVisible)===!0&&t.push({variable:l,displayName:i.displayName});let l="";return t.forEach(t=>{var i,n,o;let{variable:r,displayName:a}=t,u=null!==(n=null===(i=r.match(/gridId(\d*)/))||void 0===i?void 0:i[1])&&void 0!==n?n:null,p=r;if(p=p.replace(/^gridId(\d*)/,""),null!==u&&u!=="".concat(s))return;let f=null!==(o=d[t.variable])&&void 0!==o?o:0,w=null!=a?a:p;l+="".concat(w,": ").concat(f,"\n")}),l},[d,a,s]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"jsx-b8a41a65e357b7c container",children:[(0,n.jsx)("div",{className:"jsx-b8a41a65e357b7c text1",children:l}),(0,n.jsx)("div",{className:"jsx-b8a41a65e357b7c text2",children:i}),(0,n.jsx)("div",{className:"jsx-b8a41a65e357b7c text3",children:r}),(0,n.jsx)("div",{className:"jsx-b8a41a65e357b7c inventory",children:u})]}),(0,n.jsx)(O(),{id:"b8a41a65e357b7c",children:".container.jsx-b8a41a65e357b7c{}"})]})};var q=T;let J=t=>{let{}=t,l=U(t=>t.grids),i=U(t=>t.activeGridId),r=(0,o.useMemo)(()=>l.find(t=>t.id===i),[l,i]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"jsx-630d6197e7dfd107 container",children:(0,n.jsx)("div",{className:"jsx-630d6197e7dfd107 grid-text",children:r.text})}),(0,n.jsx)(O(),{id:"630d6197e7dfd107",children:".container.jsx-630d6197e7dfd107{width:400px}.grid-text.jsx-630d6197e7dfd107{font-size:18px;font-weight:bold;text-align:center}"})]})};var Z=J;let L=t=>{let{cell:l,cellIndex:i,gridId:r}=t,d=(0,o.useCallback)(t=>{let{buttons:n}=t;1===n&&""!==l.onClickCScript&&(0,F.g)(l.onClickCScript,{gridId:r,cellIndex:i})},[l]),a=(0,o.useMemo)(()=>""!==l.onClickCScript,[l.onClickCScript]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{backgroundColor:l.color,cursor:""!==l.onClickCScript?"pointer":"default"},onMouseDown:t=>d(t),className:"jsx-26f76e0e17b4ab4e "+"container ".concat(a?"gradient-border":""),children:l.emoji}),(0,n.jsx)(O(),{id:"26f76e0e17b4ab4e",children:".container.jsx-26f76e0e17b4ab4e{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;font-size:1.5em;width:40px;height:40px}.gradient-border.jsx-26f76e0e17b4ab4e{border:3px solid;border-image-slice:1;border-width:3px;border-image-source:-webkit-linear-gradient(left,#d53a9d,#3593f7);border-image-source:-moz-linear-gradient(left,#d53a9d,#3593f7);border-image-source:-o-linear-gradient(left,#d53a9d,#3593f7);border-image-source:linear-gradient(to right,#d53a9d,#3593f7)}"})]})};var W=L;let B=t=>{var l;let{}=t,i=U(t=>t.grids),r=U(t=>t.activeGridId),d=(0,o.useMemo)(()=>i.find(t=>t.id===r),[i,r]),a=U(t=>t.isInitFinished);return(0,o.useEffect)(()=>{a&&((0,F.g)(d.onViewGScript,{gridId:d.id}),d.cells.forEach((t,l)=>(0,F.g)(t.onViewCScript,{gridId:d.id,cellIndex:l})))},[d,a]),(0,n.jsxs)("div",{className:"jsx-8e014bfb7ac77af5",children:[(0,n.jsx)("div",{style:{backgroundImage:"url(".concat(null!==(l=d.backgroundImage)&&void 0!==l?l:"",")")},onContextMenu:t=>{t.preventDefault()},className:"jsx-8e014bfb7ac77af5 container",children:d.cells.map((t,l)=>(0,n.jsx)(W,{cell:t,gridId:r,cellIndex:l},l))}),(0,n.jsx)(O(),{id:"8e014bfb7ac77af5",children:".container.jsx-8e014bfb7ac77af5{display:grid;grid-template-columns:repeat(10,40px);grid-auto-rows:40px;outline-color:rgba(50,115,220,.1);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-background-size:contain;-moz-background-size:contain;-o-background-size:contain;background-size:contain}.container.jsx-8e014bfb7ac77af5>*.jsx-8e014bfb7ac77af5{outline-color:rgba(50,115,220,.1)}"})]})};var H=B;let K=t=>{let{}=t;return(0,n.jsxs)("div",{children:[(0,n.jsx)(H,{}),(0,n.jsx)(Z,{}),(0,n.jsx)(q,{})]})};var Q=K;let R=t=>{let{adventure:l}=t,[i,r]=(0,o.useState)(!1),d=U(t=>t.reset);return((0,o.useEffect)(()=>{d(),M();let{data:t,...i}=l,n=JSON.parse(t),o=n.grids,a=n.firstGridId,s=n.firstGridId,u=n.onInitAScript;U.setState({grids:o,firstGridId:a,activeGridId:s,onInitAScript:u,adventure:i}),(0,F.g)(u),o.forEach(t=>(0,F.g)(t.onInitGScript,{gridId:t.id})),o.forEach(t=>{t.cells.forEach((l,i)=>{(0,F.g)(l.onInitCScript,{gridId:t.id,cellIndex:i})})}),U.setState({isInitFinished:!0}),r(!0)},[]),i)?(0,n.jsx)(Q,{}):(0,n.jsx)("div",{children:"Loading...."})};var X=R},207:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{g:function(){return evalScript}});let getRegexes=(t,l)=>[["$#.","window._subscriberProxy.","Add a subscriber to a global (adventure) variable. (e.g. $#.score = v => console.log(`score: ${v}`))"],["%#.","window._configProxy.","Config global (adventure) variable (such for displaying or display name)"],["#.","window._variableProxy.","Global (adventure) variable"],["$@.","window._subscriberProxy.".concat(null===t?"":"gridId".concat(t)),"Add a subscriber to a grid variable. (e.g. $@.count = v => v > 10 && #m(2))"],["%@.","window._configProxy.".concat(null===t?"":"gridId".concat(t)),"Config grid variable (use only in a Grid or Cell)"],["@.","window._variableProxy.".concat(null===t?"":"gridId".concat(t)),"Grid variable (use only in a Grid or Cell)"],["$^.","window._subscriberProxy.".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Add a subscriber to a cell variable. (e.g. $^.life = v => v <= 0 && ^d)"],["%^.","window._configProxy.".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Config cell variable (use only in a Cell)"],["^.","window._variableProxy.".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Cell variable (use only in a Cell)"],["@gi","".concat(t),"Get gridId (in a Grid or Cell)"],["^ci","".concat(l),"Get cellId (in a Cell)"],["^cs","window._updateProxy.onClickCScript_".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Update click script of the cell"],["^vs","window._updateProxy.onViewCScript_".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Update view script of the cell"],["^c","window._updateProxy.color_".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Update color of the cell"],["^e","window._updateProxy.emoji_".concat(null===t?"":"gridId".concat(t)).concat(null===l?"":"cellIndex".concat(l)),"Update emoji/character of the cell"],["^dcs","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { onClickCScript: "" }})'),"Delete click script of the cell (no () needed)"],["^dvs","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { onViewCScript: "" }})'),"Delete view script of the cell"],["^dc","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { color: "" }})'),"Delete color of the cell"],["^de","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { emoji: "" }})'),"Delete emoji of the cell"],["^dd","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { emoji: "", color: "", onClickCScript: "", onViewScript: "" }})'),"Delete emoji, click script and view script of the cell (equivalent to ^e = '', ^c = '', ^cs = '' and ^vs = '')"],["^d","window._ss().updateCell({ gridId: ".concat(null!=t?t:"0",", cellIndex: ").concat(null!=l?l:"0",', cellUpdate: { emoji: "", onClickCScript: "", onViewScript: "" }})'),"Delete emoji, click script and view script of the cell (equivalent to ^e = '', ^cs = '' and ^vs = '')"],[/\#tt\((.*?)\)/g,"window._s.setState({ text2: $1 })","Display text under the grid (second position)","#tt($1)"],[/\#t\((.*?)\)/g,"window._s.setState({ text1: $1 })","Display text under the grid","#t($1)"],[/\#\((.*?)\)/g,"window._s.setState({ text1: `$1` })","Display text under the grid (no quotes needed)","#($1)"],["#g(","window._s.getState(","Get the state of the Zustand store (all data used by the adventure)"],["#s(","window._s.setState(","Set the state of the Zustand store (you can reactively change everything)"],["#u(","window._ss().updateCell(","Update cell (you have to provide gridId, cellId, and the update object)"],[/\#\#a\((.*?)\)/g,"setTimeout(() => { window.alert($1) }, 10)","Display alert dialog, delayed after the grid is visually loaded","##a($1)"],["#a(","window.alert(","Display alert dialog (compatible with variables and string interpolation)"],["#p(","window.prompt(","Display prompt dialog"],["#c(","window.confirm(","Display confirm dialog"],[/\#m\((.*?)\)/g,"window._s.setState({ activeGridId: $1 })","Move to specified gridId","#m($1)"]],evalScript=function(script){let{gridId,cellIndex}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(""===script)return;let regexes=getRegexes(gridId,cellIndex),newScript=script;regexes.forEach(t=>{newScript=newScript.replaceAll(t[0],t[1])}),eval(newScript)}},271:function(t,l,i){Promise.resolve().then(i.bind(i,8918))}},function(t){var l=function(l){return t(t.s=l)};t.O(0,[862,667,961,744],function(){return l(271)}),_N_E=t.O()}]);